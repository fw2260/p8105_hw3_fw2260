---
title: "Homework 3"
author: "Lily Wang"
date: "10/4/2020"
output: github_document
---

This is my solution to Homework 3.

```{r setup}
library(tidyverse)
library(p8105.datasets)
```

## Problem 1

Load and clean dataset:

```{r import_instacart}
data("instacart")
```

The `instacart` dataset contains information on online grocery orders from users of Instacart, an online grocery service that allows you to shop online from local stores. Each observation is one item ordered by a user. Specifically, there are variables of the IDs of orders, products, and users, when the order was placed, how many days passed since the last order, the name of the product ordered, and what aisle and department it was from. The dataset has `r nrow(instacart)` rows and `r ncol(instacart)` columns.

```{r count_aisles}
instacart %>% 
  count(aisle) %>% 
  arrange(desc(n))
```

There are `r nrow(distinct(instacart, aisle))` distinct aisles. The aisles with the most products are fresh vegetables, fresh fruits, packaged vegetables and fruits, and yogurt.

Making a plot that shows the number of items ordered in each aisle, limiting this to aisles with more than 10000 items ordered:

```{r}
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(
    aisle = factor(aisle),
    aisle = fct_reorder(aisle, n)
  ) %>% 
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

Making a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”. Number of times each item is ordered is included:

```{r rank_items}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(
    rank = min_rank(desc(n))
  ) %>% 
  filter(rank < 4) %>% 
  arrange(aisle, rank) %>% 
  knitr::kable(digits = 0)
```

Making a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week:

```{r apple_icecream}
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_hour = mean(order_hour_of_day)) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) %>% 
  knitr::kable(digits = 0)
```


## Problem 2

```{r clean_accel}
accel_df <- read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    starts_with("activity_"),
    names_to = "activity",
    names_prefix = "activity_",
    values_to = "counts"
  ) %>% 
  mutate(
    activity = as.numeric(activity),
    day = factor(day),
    day = fct_relevel(day, c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))) %>% 
  arrange(week, day)
```

The current dataset is accelerometer data of a 63-year-old male who was admitted to the Advanced Cardiac Care Center of Columbia University Medical Center and diagnosed with congestive heart failure (CHF). The accelerometer measures the wearer's activity at each minute of a 24-hour day starting at midnight. The dataset contains `r nrow(accel_df)` rows and `r ncol(accel_df)` columns.

Aggregate across minutes to create a total activity variable for each day:

```{r aggregate_activity}
accel_df %>% 
  group_by(week, day) %>% 
  summarize(
    total_activity = sum(counts)) %>% 
  knitr::kable(digits = 0)
```

Weekends of Week 4 and 5 seem to have lower activity. Let's plot these:

```{r plot_activity}
accel_df %>% 
  ggplot(aes(x = activity, y = counts, color = day)) +
  geom_line() +
  theme(legend.position = "bottom")
```


## Problem 3

```{r import_noaa}
data("ny_noaa")
```

The `ny_noaa` dataset contains weather information from the National Oceanic and Atmospheric Association for all New York State weather stations from January 1, 1981 through December 31, 2010. Specifically, the dataset contains the weather station ID, date of observation, amount of precipitation (in tenths of mm) and snow (in mm), and minimum and maximum temperature (in tenths of degrees C). The current dataset is `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns.

```{r}
ny_noaa %>%  
  janitor::clean_names() %>% 
  separate(date, c("year", "month", "day"), "-") %>% 
  mutate(
    tmin = as.numeric(tmin),
    tmax = as.numeric(tmax),
    tmin = tmin / 10,
    tmax = tmax / 10
  )
```

